# Build status

[![.NET](https://github.com/roxanabatinas/CommunityProject-Trivia/actions/workflows/dotnet.yml/badge.svg?branch=master)](https://github.com/roxanabatinas/CommunityProject-Trivia/actions/workflows/dotnet.yml)

# CommunityProject-Trivia
This is the repository of the Trivia .NET Community Project

The trivia application is developed using .NET 6 and Visual Studio 2022, therefore before opening the solution, make sure both are installed on your local development environment.

Other useful components that you will need to have installed and configured on your development environment are:
- Microsoft SQL Server
- SQL Server Management Studio
- RabbitMQ

## Setup
In order to start the project for the first time you need to:
- Update the appsettings with the connection string of the database based on your local configurations for the following projects:
  - .\Services\Game\Game.API\appsettings.json
  - .\Services\Identity\Identity.API\appsettings.json
- Right click on the solution in Visual Studio and set as Startup projects:
  - Game.API
  - Identity.API
  - Game.Blazor
- In order to test the application, you can register as a new user or use the admin user:
  - Username: admin
  - Password: Pass123$
- In order to test the application, you can register as a new user or use the member user:
  - Username: member
  - Password: Pass123$
  When you register you will be granted by default with the member role.
- The database for Game API will be created automatically, but if you want to change the structure, you need to add new migrations. You can use the following script to add a new migration for Trivia database for example:
dotnet ef migrations add Initial --verbose --project "UpdateWithFullPathToProject\Services\Game\Game.Infrastructure\Game.Infrastructure.csproj" --startup-project "UpdateWithFullPathToProject\Services\Game\Game.API\Game.API.csproj" --context TriviaDbContext

- The database for Identity API will be created automatically, but if you want to change the structure, you need to add new migrations by running .\Services\Indentity\Identity.API\buildschema.bat script

- To setup RabbitMQ
	- Download Docker for desktop https://www.docker.com/products/docker-desktop/
	- Open a cmd prompt as Admin: open a run-box, write cmd and press Control + Shift + Enter to open the command prompt as an administrator
	- Execute this command: docker run -d --hostname my-rabbitmq-server --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
		This command will create in Docker desktop application an image with RabbitMQ running
	- To access this image, open a browser window and navigate to localhost:15672, using the default login of guest/guest
		We now have access to the RabbitMQ UI image available on Docker and we can see the requests and messages arriving from Trivia
	- If the page is not running, check on Docker desktop application that the image is started. You might need to do this manually.
	
Documentation for MassTransit with RabbitMQ
https://code-maze.com/masstransit-rabbitmq-aspnetcore/

- To setup FluentEmail
	- Download Docker for desktop https://www.docker.com/products/docker-desktop/
	- Open a cmd prompt as Admin: open a run-box, write cmd and press Control + Shift + Enter to open the command prompt as an administrator
	- Execute this command to install the email simulator: dotnet tool install -g Rnwood.Smtp4dev
	- Execute this command to open the simulator in docker: docker run --rm -it -p 3000:80 -p 2525:25 rnwood/smtp4dev
		This command will create in Docker desktop application an image with email simulator
	- To access this image, open a browser window and navigate to http://localhost:3000/ where you can see the email flow generated by Trivia and the email formats

Documentation for FluentEmail
https://code-maze.com/dotnet-sending-email-with-fluentemail/
https://github.com/rnwood/smtp4dev/wiki/Installation

#Document to be completed when other useful information is needed.
